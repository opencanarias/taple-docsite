"use strict";(self.webpackChunkclassic=self.webpackChunkclassic||[]).push([[7751],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>d});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),u=p(n),d=o,m=u["".concat(l,".").concat(d)]||u[d]||h[d]||i;return n?a.createElement(m,s(s({ref:t},c),{},{components:n})):a.createElement(m,s({ref:t},c))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,s=new Array(i);s[0]=u;var r={};for(var l in t)hasOwnProperty.call(t,l)&&(r[l]=t[l]);r.originalType=e,r.mdxType="string"==typeof e?e:o,s[1]=r;for(var p=2;p<i;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},57022:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>p});var a=n(87462),o=(n(67294),n(3905));const i={},s="Interacting with the network",r={unversionedId:"build/access-control/interacting-network",id:"version-0.3/build/access-control/interacting-network",title:"Interacting with the network",description:"Now that we have our network set up and configured, we will move on to simulate the operation of the use case. To simplify the interaction, we will limit the use case to the interaction with a vehicle.",source:"@site/versioned_docs/version-0.3/build/access-control/interacting-network.md",sourceDirName:"build/access-control",slug:"/build/access-control/interacting-network",permalink:"/taple-docsite/docs/build/access-control/interacting-network",draft:!1,tags:[],version:"0.3",lastUpdatedAt:1698048419,formattedLastUpdatedAt:"Oct 23, 2023",frontMatter:{},sidebar:"buildSidebar",previous:{title:"Setting up the network",permalink:"/taple-docsite/docs/build/access-control/setting-network"},next:{title:"Issues and Workarounds",permalink:"/taple-docsite/docs/build/issues-and-workarounds"}},l={},p=[{value:"Rent a vehicle",id:"rent-a-vehicle",level:2},{value:"Opening of the vehicle to the assigned driver",id:"opening-of-the-vehicle-to-the-assigned-driver",level:2},{value:"Unrental vehicle",id:"unrental-vehicle",level:2},{value:"Opening of the vehicle to cleaning personnel",id:"opening-of-the-vehicle-to-cleaning-personnel",level:2},{value:"Opening rejected",id:"opening-rejected",level:2},{value:"Security company",id:"security-company",level:2}],c={toc:p};function h(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"interacting-with-the-network"},"Interacting with the network"),(0,o.kt)("p",null,"Now that we have our network set up and configured, we will move on to simulate the operation of the use case. To simplify the interaction, we will limit the use case to the interaction with a vehicle."),(0,o.kt)("h2",{id:"rent-a-vehicle"},"Rent a vehicle"),(0,o.kt)("p",null,'The first case we face is when a client comes to the rental company with the intention of renting a vehicle. To do this, we must issue a "',(0,o.kt)("strong",{parentName:"p"},"Rent"),'" event on the subject by means of an external invocation, since the owner of the subject is the vehicle. It should be noted, that the initial state of the subject is as follows:'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "last_position": {\n        "latitude": 0.0,\n        "longitude": 0.0\n    },\n    "status": "FREE"\n}\n')),(0,o.kt)("p",null,"Before making the request, we will generate the signature of the event we want to issue using ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"/taple-docsite/docs/learn/client-tools#taple-sign"},"TAPLE-Sign"))," with the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Another terminal"',title:'"Another','terminal"':!0},'taple-sign "74c417de2174f3a76b0b98343cea3aa35bfd3860cac8bf470092c3e751745c1a" \'{"Fact":{"subject_id":"{{SUBJECT-ID}}","payload":{"Rent":{}}}}\'\n')),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Note that in the request, you must replace ",(0,o.kt)("strong",{parentName:"p"},"{{SUBJECT-ID}}")," with the hash identifier of the subject.")),(0,o.kt)("p",null,"We will then include the result of the previous execution in the next request:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Vehicle"',title:'"Node:','Vehicle"':!0},"curl --request POST 'http://localhost:3003/api/event-requests' \\\n    --header 'Content-Type: application/json' \\\n    --data-raw '{{SIGN-RESULT}}'\n")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Note that in the request, you must replace ",(0,o.kt)("strong",{parentName:"p"},"{{SIGN-RESULT}}")," with the result of the previous request.")),(0,o.kt)("p",null,"Leaving us with something similar to the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Vehicle"',title:'"Node:','Vehicle"':!0},'curl --request POST \'http://localhost:3003/api/event-requests\' \\\n    --header \'Content-Type: application/json\' \\\n    --data-raw \'{\n        "request": {\n            "Fact": {\n                "subject_id": "{{SUBJECT-ID}}",\n                "payload": {\n                    "Rent": {}\n                }\n            }\n        },\n        "signature": {\n        "signer": "EbwR0yYrCYpTzlN5i5GX_MtAbKRw5y2euv3TqiTgwggs",\n        "timestamp": 1690371065334972628,\n        "value": "SEw7Ca_HkBGhaUder4KZI23PX0rsKjn-qMOL7wtnfh_CcGA6ktgkZc3o6zhLuF26_af3Z3syN0aKR3JCltZPBEAw"\n        }\n    }\'\n')),(0,o.kt)("p",null,'If everything went well, we should see that the "',(0,o.kt)("strong",{parentName:"p"},"sn"),'" field has increased and the vehicle status has changed from FREE to RENTED. To do this, run the following command:'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Vehicle"',title:'"Node:','Vehicle"':!0},"curl 'http://localhost:3003/api/subjects/{{SUBJECT-ID}}'\n")),(0,o.kt)("p",null,"In addition, as mentioned above, every 10 minutes the vehicle broadcasts an event to update the geolocation of the car. This event is triggered as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Vehicle"',title:'"Node:','Vehicle"':!0},'curl --request POST \'http://localhost:3003/api/event-requests\' \\\n    --header \'Content-Type: application/json\' \\\n    --data-raw \'{\n        "request": {\n            "Fact": {\n                "subject_id": {{SUBJECT-ID}},\n                "payload": {\n                    "UpdatePosition": {\n                        "latitude": -30.0,\n                        "longitude": -64.0\n                    }\n                }\n            }\n        }\n    }\'\n')),(0,o.kt)("p",null,"It should be noted that in this case the request is not signed as the request is issued by the owner and will be signed internally."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"You should know that the client's REST API supports both signed and unsigned requests and if they are unsigned, the request is signed with the owner's cryptographic material. To learn more, visit this ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"/taple-docsite/docs/learn/client-usage#rest-api"},"link")),".")),(0,o.kt)("p",null,'Once executed, we should see how the "',(0,o.kt)("strong",{parentName:"p"},"sn"),"\" field has increased and the vehicle's geolocation has been updated. To do this, run the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Vehicle"',title:'"Node:','Vehicle"':!0},"curl 'http://localhost:3003/api/subjects/{{SUBJECT-ID}}'\n")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Note that in the above requests, you must replace ",(0,o.kt)("strong",{parentName:"p"},"{{SUBJECT-ID}}")," with the hash identifier of the previously saved subject.")),(0,o.kt)("h2",{id:"opening-of-the-vehicle-to-the-assigned-driver"},"Opening of the vehicle to the assigned driver"),(0,o.kt)("p",null,"Before proceeding to unlock the vehicle, the client must generate a key pair using the ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"/taple-docsite/docs/learn/client-tools#taple-keygen"},"TAPLE Keygen"))," tool as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Another terminal"',title:'"Another','terminal"':!0},"taple-keygen\n")),(0,o.kt)("p",null,"obtaining as output the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Another terminal"',title:'"Another','terminal"':!0},"controller_id: EHQNUnel9CCeL9E8Ov8UmQyn436zBUOBb_zJVf0qs04M\npeer_id: 12D3KooWBmcwLJ9JyjgeBHo1gVT5Xc9YEMexNxqCracbYC4AsjEi\nprivate_key: 3a7bd6128eb89f9c6f2e7f82575bf1c9cad7521a29e2ca56f87920b41ae84507\n")),(0,o.kt)("p",null,"You must then inform the rental company of your public key, which in this case is: ",(0,o.kt)("inlineCode",{parentName:"p"},"EHQNUnel9CCeL9E8Ov8UmQyn436zBUOBb_zJVf0qs04M"),"."),(0,o.kt)("p",null,"Now, the assigned driver arrives at the vehicle and using their NFC, triggers the car to issue a signed event request similar to the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Vehicle"',title:'"Node:','Vehicle"':!0},'curl --request POST \'http://localhost:3003/api/event-requests\' \\\n    --header \'Content-Type: application/json\' \\\n    --data-raw \'{\n        "request": {\n            "Fact": {\n                "subject_id": "{{SUBJECT_ID}}",\n                "payload": {\n                    "Open": {}\n                }\n            }\n        },\n        "signature": {\n        "signer": "EHQNUnel9CCeL9E8Ov8UmQyn436zBUOBb_zJVf0qs04M",\n        "timestamp": 1690967017498090720,\n        "value": "SEFa0SD1pGMrt7AIV2VHIKsTchP118O2BDN2_43vPihJ0M03vcDuq6spqgEXwgccQqxf2pidSDBEHPtZrafeUgBQ"\n        }\n    }\'\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note:"),' Save the "',(0,o.kt)("strong",{parentName:"p"},"request_id"),'" for future steps. '),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Note that to generate the content of the above request it is necessary to execute the following command:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Another terminal"',title:'"Another','terminal"':!0},'taple-sign "3a7bd6128eb89f9c6f2e7f82575bf1c9cad7521a29e2ca56f87920b41ae84507" \'{"Fact":{"subject_id":"{{SUBJECT-ID}}","payload":{"Open":{}}}}\'\n')),(0,o.kt)("p",{parentName:"admonition"},"Remember to replace the ",(0,o.kt)("strong",{parentName:"p"},"{{SUBJECT-ID}}"),".")),(0,o.kt)("p",null,"Then, the rental company and the cleaning/maintenance company would receive a request for approval on the invocation made so that each of them must check in their internal systems if the identity of the issuer is valid and vote yes or no. In this case, it is the driver to whom the car has been leased, so the rental company must accept the request and the cleaning/maintenance company must deny it. In this case, it is the driver to whom the car has been rented so the reting company should accept the request and the cleaning/maintenance company should deny the request. As we are facing a quorum of 1, the request will be accepted and therefore the vehicle will be opened. Before moving on to the voting phase, it will be necessary to get the new request for approval. To do so, we execute the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Rental Company"',title:'"Node:',Rental:!0,'Company"':!0},"curl 'http://localhost:3000/api/approval-requests?status=Pending'\n")),(0,o.kt)("p",null,"obtaining as output the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Rental Company"',title:'"Node:',Rental:!0,'Company"':!0},'[\n    {\n        "id": "JKQ3GyHKPqp52Czjytyzt9CubBQ6uw3atRED8derXxDc",\n        "request": {\n            "event_request": {\n                "Fact": {\n                    "subject_id": "{{SUBJECT_ID}}",\n                    "payload": {\n                        "Open": {}\n                    }\n                },\n                "signature": {\n                    "signer": "EHQNUnel9CCeL9E8Ov8UmQyn436zBUOBb_zJVf0qs04M",\n                    "timestamp": 1690971689672314415,\n                    "value": "SEeqYTA30jlswpTNLcWsNB9_yzmRd75Kg-z2mvtf4ijkvBq7WkXep6U3uTIcoza-4mpZM84lCPAHe1Ck-uo-TUCg"\n                }\n            },\n            "sn": 4,\n            "gov_version": 1,\n            "patch": [],\n            "state_hash": "Jk8BpV-OXeyGmHem8fdmBKWqGYr06WqHVCBWwKxrC9E8",\n            "hash_prev_event": "JL8CRP7RumsWx532ndo8NHNJMQ-lEtdc8TnoqeydZgKI",\n            "signature": {\n                "signer": "EF-yDpvFF5Vt9NYYCYCix1bT171UqC2vG71HGCJSwH10",\n                "timestamp": 1690971723297119730,\n                "value": "SEhAMKMCGfnbKcRICfvYpSHjPl9NNOnvs3_VyqySFzv66uBmImRIZq9EcwgWoGj8cHzEjLiNXNsax_f7sBNJXeAA"\n            }\n        },\n        "reponse": null,\n        "state": "Pending"\n    }\n]\n')),(0,o.kt)("p",null,'where we can check that the "',(0,o.kt)("strong",{parentName:"p"},"signer"),'" corresponds to the client identifier.'),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note:"),' Save the value of the "',(0,o.kt)("strong",{parentName:"p"},"id"),'" field returned by the previous request.'),(0,o.kt)("p",null,"Now, we are ready for the approval phase. To do this, we must execute the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Rental Company"',title:'"Node:',Rental:!0,'Company"':!0},"curl --request POST 'http://localhost:3000/api/approval-requests/{{PREVIUS-ID}}' \\\n    --header 'Content-Type: application/json' \\\n    --data '{\"state\": \"RespondedAccepted\"}'\n")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Note that in the request, you must replace ",(0,o.kt)("strong",{parentName:"p"},"{{PREVIUS-ID}}")," with the value copied from above.")),(0,o.kt)("p",null,"It should be noted that if, in the approval phase, we vote first from the rental company node, there is no need to vote from the cleaning company, since the quorum has already been reached."),(0,o.kt)("p",null,"Finally, to check that the vehicle door has been successfully opened, we must execute the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Vehicle"',title:'"Node:','Vehicle"':!0},"curl 'http://localhost:3003/api/event-requests/{{REQUEST-ID}}/state'\n")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Note that in the request, you must replace ",(0,o.kt)("strong",{parentName:"p"},"{{REQUEST-ID}}")," with the value copied above.")),(0,o.kt)("p",null,"where we can see that the event has been performed correctly, obtaining an output similar to the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'{\n    "id": "{{REQUEST-ID}}",\n    "subject_id": "{{SUBJECT-ID}}",\n    "sn": 4,\n    "state": "finished",\n    "success": true\n}\n')),(0,o.kt)("h2",{id:"unrental-vehicle"},"Unrental vehicle"),(0,o.kt)("p",null,"Then, when the client has finished with the disposal of the vehicle, the rental company must update its status to set it as free. To do this, we must issue an event on the subject by means of an external invocation. It should be noted that the current state of the subject is as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "last_position": {\n        "latitude": -30.0,\n        "longitude": -64.0\n    },\n    "status": "RENTED"\n}\n')),(0,o.kt)("p",null,"Before making the request, we will generate the signature of the event we want to issue using ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"/taple-docsite/docs/learn/client-tools#taple-sign"},"TAPLE-Sign"))," with the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Another terminal"',title:'"Another','terminal"':!0},'taple-sign "74c417de2174f3a76b0b98343cea3aa35bfd3860cac8bf470092c3e751745c1a" \'{"Fact":{"subject_id":"{{SUBJECT-ID}}","payload":{"Unrental":{}}}}\'\n')),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Note that in the request, you must replace ",(0,o.kt)("strong",{parentName:"p"},"{{SUBJECT-ID}}")," with the hash identifier of the subject.")),(0,o.kt)("p",null,"We will then include the result of the previous execution in the next request:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Vehicle"',title:'"Node:','Vehicle"':!0},"curl --request POST 'http://localhost:3003/api/event-requests' \\\n    --header 'Content-Type: application/json' \\\n    --data-raw '{{SIGN-RESULT}}'\n")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Note that in the request, you must replace ",(0,o.kt)("strong",{parentName:"p"},"{{SIGN-RESULT}}")," with the result of the previous request.")),(0,o.kt)("p",null,"Leaving us with something similar to the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Vehicle"',title:'"Node:','Vehicle"':!0},'curl --request POST \'http://localhost:3003/api/event-requests\' \\\n    --header \'Content-Type: application/json\' \\\n    --data-raw \'{\n        "request": {\n            "Fact": {\n                "subject_id": "{{SUBJECT-ID}}",\n                "payload": {\n                    "Unrental": {}\n                }\n            }\n        },\n        "signature": {\n        "signer": "EbwR0yYrCYpTzlN5i5GX_MtAbKRw5y2euv3TqiTgwggs",\n        "timestamp": 1690448459062654370,\n        "value": "SEMOYViWsNV9PNsWEkmQTy82-O5Lb_pMcvpurF3XC1LPnHldtHarEogHYOEvrifxuyeO-X_XHlAoI3jE2nmb4IDg"\n        }\n    }\'\n')),(0,o.kt)("p",null,'If everything went well, we should see that the "',(0,o.kt)("strong",{parentName:"p"},"sn"),'" field has increased and the vehicle status has changed from RENTED to FREE. To do this, run the following command:'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Vehicle"',title:'"Node:','Vehicle"':!0},"curl 'http://localhost:3003/api/subjects/{{SUBJECT-ID}}''\n")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Note that in the request, you must substitute ",(0,o.kt)("strong",{parentName:"p"},"{{SUBJECT-ID}}")," for the hash identifier of the previously saved subject.")),(0,o.kt)("h2",{id:"opening-of-the-vehicle-to-cleaning-personnel"},"Opening of the vehicle to cleaning personnel"),(0,o.kt)("p",null,"Now, we are faced with the use case that a cleaning/maintenance personnel wants to open the vehicle. Before proceeding to open the vehicle, the awarded personnel must generate a key pair using the ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"/taple-docsite/docs/learn/client-tools#taple-keygen"},"TAPLE Keygen"))," tool as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Another terminal"',title:'"Another','terminal"':!0},"taple-keygen\n")),(0,o.kt)("p",null,"obtaining as output the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Another terminal"',title:'"Another','terminal"':!0},"controller_id: EBKUYdoJZCkIr2UnIc22LmeAIHKDQQIFFDFzoMN34gC4\npeer_id: 12D3KooWA8VozHkYiNv9hwYKh37B61o8JSEzXCGA1WfxbZbAgwS5\nprivate_key: e34a939ab13fd7a2785949ddd180f4c502dcd4a28c98788edd3933834c7f88bb\n")),(0,o.kt)("p",null,"You must then inform the cleaning company of your public key, which in this case is: ",(0,o.kt)("inlineCode",{parentName:"p"},"EBKUYdoJZCkIr2UnIc22LmeAIHKDQQIFFDFzoMN34gC4"),"."),(0,o.kt)("p",null,"Now, the personnel assigned to perform such service, arrives at the vehicle and using their NFC, causes the car to issue a signed event request similar to the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Vehicle"',title:'"Node:','Vehicle"':!0},'curl --request POST \'http://localhost:3003/api/event-requests\' \\\n    --header \'Content-Type: application/json\' \\\n    --data-raw \'{\n        "request": {\n            "Fact": {\n                "subject_id": "{{SUBJECT_ID}}",\n                "payload": {\n                    "Open": {}\n                }\n            }\n        },\n        "signature": {\n        "signer": "EBKUYdoJZCkIr2UnIc22LmeAIHKDQQIFFDFzoMN34gC4",\n        "timestamp": 1690972286292619899,\n        "value": "SEcF4CFdv3WpKkh7zLgahR-XI2yYdF1HJcG-gI4hzRQPWXYVLgeFq608Tgx2dvOAe37WKMTdJWV5wk-V3oMN6bCA"\n        }\n    }\'\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note:"),' Save the "',(0,o.kt)("strong",{parentName:"p"},"request_id"),'" for future steps. '),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Note that to generate the content of the above request it is necessary to execute the following command:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Another terminal"',title:'"Another','terminal"':!0},'taple-sign "e34a939ab13fd7a2785949ddd180f4c502dcd4a28c98788edd3933834c7f88bb" \'{"Fact":{"subject_id":"{{SUBJECT-ID}}","payload":{"Open":{}}}}\'\n')),(0,o.kt)("p",{parentName:"admonition"},"Remember to replace the ",(0,o.kt)("strong",{parentName:"p"},"{{SUBJECT-ID}}"),".")),(0,o.kt)("p",null,"Then, the rental company and the cleaning/maintenance company would receive a request for approval on the invocation made so that each of them must check in their internal systems if the identity of the issuer is valid and vote yes or no. In this case, it is the cleaning/maintenance personnel, so the cleaning/maintenance company will accept the request and the vehicle will be opened since we are facing a quorum of 1. In this case, we are dealing with cleaning/maintenance personnel, so the cleaning/maintenance company will accept the request and the vehicle will be opened since we are facing a quorum of 1. Before moving on to the voting phase, it will be necessary to obtain the new update request. To do this, we run the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Cleaning Company"',title:'"Node:',Cleaning:!0,'Company"':!0},"curl 'http://localhost:3001/api/approval-requests?status=Pending'\n")),(0,o.kt)("p",null,"obtaining as output the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Cleaning Company"',title:'"Node:',Cleaning:!0,'Company"':!0},'[\n    {\n        "id": "J9soJTgfN5u16U1mFcqNBYgi6r3qrfBWmWqczZUc_Vfs",\n        "request": {\n            "event_request": {\n                "Fact": {\n                    "subject_id": "{{SUBJECT_ID}}",\n                    "payload": {\n                        "Open": {}\n                    }\n                },\n                "signature": {\n                    "signer": "EBKUYdoJZCkIr2UnIc22LmeAIHKDQQIFFDFzoMN34gC4",\n                    "timestamp": 1690972286292619899,\n                    "value": "SEcF4CFdv3WpKkh7zLgahR-XI2yYdF1HJcG-gI4hzRQPWXYVLgeFq608Tgx2dvOAe37WKMTdJWV5wk-V3oMN6bCA"\n                }\n            },\n            "sn": 6,\n            "gov_version": 1,\n            "patch": [],\n            "state_hash": "Jk8BpV-OXeyGmHem8fdmBKWqGYr06WqHVCBWwKxrC9E8",\n            "hash_prev_event": "Ju5EjCcdY9VXQFNDKSr1oZAnDcMTsap-Iv3cbCTjHHzY",\n            "signature": {\n                "signer": "EF-yDpvFF5Vt9NYYCYCix1bT171UqC2vG71HGCJSwH10",\n                "timestamp": 1690972446119230523,\n                "value": "SEobTNPEy_Pc4R6aOVnYdzNGYbfvT7oqgk9RFgUcxtuCklbN1f2PMtfSeqBFNTOHplYJs2SNKt_KQw6FNmI4xbBw"\n            }\n        },\n        "reponse": null,\n        "state": "Pending"\n    }\n]\n')),(0,o.kt)("p",null,'where we can check that the "',(0,o.kt)("strong",{parentName:"p"},"signer"),'" corresponds to the client identifier.'),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note:"),' Save the value of the "',(0,o.kt)("strong",{parentName:"p"},"id"),'" field returned by the previous request.'),(0,o.kt)("p",null,"Now, we are ready for the approval phase. To do this, we must execute the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Cleaning Company"',title:'"Node:',Cleaning:!0,'Company"':!0},"curl --request POST 'http://localhost:3001/api/approval-requests/{{PREVIUS-ID}}' \\\n    --header 'Content-Type: application/json' \\\n    --data '{\"state\": \"RespondedAccepted\"}'\n")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Note that in the request, you must replace ",(0,o.kt)("strong",{parentName:"p"},"{{PREVIUS-ID}}")," with the value copied from above.")),(0,o.kt)("p",null,"It should be noted that if, in the approval phase, we vote first from the cleaning/maintenance company node, there is no need to vote from the rental company, since the quorum has already been reached."),(0,o.kt)("p",null,"Finally, to check that the vehicle door has been opened successfully, we must execute the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Vehicle"',title:'"Node:','Vehicle"':!0},"curl --request POST 'http://localhost:3003/api/event-requests/{{REQUEST-ID}}/state'\n")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Note that in the request, you must replace ",(0,o.kt)("strong",{parentName:"p"},"{{REQUEST-ID}}")," with the value copied above.")),(0,o.kt)("p",null,"where we can see that the event has been performed correctly, obtaining an output similar to the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'{\n    "id": "{{REQUEST-ID}}",\n    "subject_id": "{{SUBJECT-ID}}",\n    "sn": 6,\n    "state": "finished",\n    "success": true\n}\n')),(0,o.kt)("h2",{id:"opening-rejected"},"Opening rejected"),(0,o.kt)("p",null,"As a last case, we need to check what happens when a user not identified by the rental company or the cleaning company tries to open a vehicle. Currently, the current status of the subject is as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "last_position": {\n        "latitude": -30.0,\n        "longitude": -64.0\n    },\n    "status": "FREE"\n}\n')),(0,o.kt)("p",null,"Next, the user generates his key pair using the ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"/taple-docsite/docs/learn/client-tools#taple-keygen"},"TAPLE Keygen"))," tool as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Another terminal"',title:'"Another','terminal"':!0},"taple-keygen\n")),(0,o.kt)("p",null,"obtaining as output the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Another terminal"',title:'"Another','terminal"':!0},"controller_id: E-Hl0GnPy0DY0iQYzVC64g8GmfRcEUtMES9UnI80XqEk\npeer_id: 12D3KooWSYJh63cUkuUFFJGPwxqxsywA4V1pJR2YRuVDAop3ruX6\nprivate_key: b03e9ac64f00da2df13e0f7498fcfccf87ecf467294ad93df46072716627ca05\n")),(0,o.kt)("p",null,"Now, this user arrives at the vehicle and using their NFC, causes the car to issue a signed event request similar to the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Vehicle"',title:'"Node:','Vehicle"':!0},'curl --request POST \'http://localhost:3003/api/event-requests\' \\\n    --header \'Content-Type: application/json\' \\\n    --data-raw \'{\n        "request": {\n            "Fact": {\n                "subject_id": "{{SUBJECT-ID}}",\n                "payload": {\n                    "Open": {}\n                }\n            }\n        },\n        "signature": {\n            "signer": "E-Hl0GnPy0DY0iQYzVC64g8GmfRcEUtMES9UnI80XqEk",\n            "timestamp": 1691067255233609384,\n            "value": "SEsYld7XVNdDX68PMUIRj4_Cn3I7mEXPocHnghQ__MjxEHyvDlMjshHiKuICh9X_tUL5MWaCjCoP9a8G5HNpdSAQ"\n        }\n    }\'\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note:"),' Save the "',(0,o.kt)("strong",{parentName:"p"},"request_id"),'" for future steps.'),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Note that to generate the content of the above request it is necessary to execute the following command:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Another terminal"',title:'"Another','terminal"':!0},'taple-sign "b03e9ac64f00da2df13e0f7498fcfccf87ecf467294ad93df46072716627ca05" \'{"Fact":{"subject_id":"{{SUBJECT-ID}}","payload":{"Open":{}}}}\'\n')),(0,o.kt)("p",{parentName:"admonition"},"Remember to replace the ",(0,o.kt)("strong",{parentName:"p"},"{{SUBJECT-ID}}"),".")),(0,o.kt)("p",null,"Then, the rental company and the cleaning/maintenance company would receive an approval request on the invocation made, so each of them must check in their internal systems whether the identity of the issuer is valid and vote yes or no. In this case, the user is not registered neither in the system of the rental company nor in the cleaning/maintenance company, so both should deny it and therefore, the vehicle will not be opened. Before proceeding to the voting phase, it will be necessary to obtain approval of the new request. To do this, we execute the following commands:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Rental Company"',title:'"Node:',Rental:!0,'Company"':!0},"curl 'http://localhost:3000/api/approval-requests?status=Pending'\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Cleaning Company"',title:'"Node:',Cleaning:!0,'Company"':!0},"curl 'http://localhost:3001/api/approval-requests?status=Pending'\n")),(0,o.kt)("p",null,"Both will return the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'[\n    {\n        "id": "JMiikHnC7e7EdcZFVWS1ETcEQnSPcUh1pRtk0X63IvwA",\n        "request": {\n            "event_request": {\n                "Fact": {\n                    "subject_id": "{{SUBJECT-ID}}",\n                    "payload": {\n                        "Open": {}\n                    }\n                },\n                "signature": {\n                    "signer": "EBKUYdoJZCkIr2UnIc22LmeAIHKDQQIFFDFzoMN34gC4",\n                    "timestamp": 1691065644674220886,\n                    "value": "SEzHNvQCRhgUni13-uJFDtSsMzFYSjWgm4SdOHR-9D5TLKq3DXEYczFslCM3FzKs0vEvlr7w_UHCI0rW59O5G7Ag"\n                }\n            },\n            "sn": 7,\n            "gov_version": 1,\n            "patch": [],\n            "state_hash": "JccxUyFfgLYAsoo2rhT-KwZvc7vMNSg2MBeehabEzDFw",\n            "hash_prev_event": "JZPjlTBzEZk5p9MVfmWvJQ81XBgAQE5ILIGIB6p6ilGI",\n            "signature": {\n                "signer": "EpN8qH2SHltNrT_qEqWvUmWuz34xIzmOZ9pmgvwdT4Gg",\n                "timestamp": 1691065663855558219,\n                "value": "SEHJjcopBk1AddD8vEdeIy_HJg-Cnmrua1jVRi8ayqzNRDorxYiMXcXPfdRdeUSGvPWUb_yG44hhjOS6P9TNKQAA"\n            }\n        },\n        "reponse": null,\n        "state": "Pending"\n    }\n]\n')),(0,o.kt)("p",null,'where we can check that the "',(0,o.kt)("strong",{parentName:"p"},"signer"),"\" corresponds to the user's identifier."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note:"),' Save the value of the "',(0,o.kt)("strong",{parentName:"p"},"id"),'" field returned by the previous request.'),(0,o.kt)("p",null,"Now, we are ready for the approval phase. To do this, we must execute the following commands:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Rental Company"',title:'"Node:',Rental:!0,'Company"':!0},"curl --request POST 'http://localhost:3000/api/approval-requests/{{PREVIUS-ID}}' \\\n    --header 'Content-Type: application/json' \\\n    --data '{\"state\": \"RespondedRejected\"}'\n")),(0,o.kt)("p",null,"If we check the status of the request, we can see how the status is still in process, since having a quourum of 1, the cleaning company could vote in favor and in this case be accepted."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Vehicle"',title:'"Node:','Vehicle"':!0},"curl 'http://localhost:3003/api/event-requests/{{REQUEST-ID}}/state'\n")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Note that in the request, you must replace ",(0,o.kt)("strong",{parentName:"p"},"{{REQUEST-ID}}")," with the value copied above.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "id": "{{REQUEST-ID}}",\n    "subject_id": "{{SUBJECT-ID}}",\n    "sn": 7,\n    "state": "proccesing",\n    "success": null\n}\n')),(0,o.kt)("p",null,"Finally, we proceed to vote with the cleaning company, refusing access as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Cleaning Company"',title:'"Node:',Cleaning:!0,'Company"':!0},"curl --request POST 'http://localhost:3001/api/approval-requests/{{PREVIUS-ID}}' \\\n    --header 'Content-Type: application/json' \\\n    --data '{\"state\": \"RespondedRejected\"}'\n")),(0,o.kt)("p",null,"Finally, if we check the status of the application again, we see that it has finished and has been rejected, so the opening of the vehicle will be denied."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Vehicle"',title:'"Node:','Vehicle"':!0},"curl 'http://localhost:3003/api/event-requests/{{REQUEST-ID}}/state'\n")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Note that in the request, you must replace ",(0,o.kt)("strong",{parentName:"p"},"{{REQUEST-ID}}")," with the value copied above.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "id": "{{REQUEST-ID}}",\n    "subject_id": "{{SUBJECT-ID}}",\n    "sn": 7,\n    "state": "finished",\n    "success": false\n}\n')),(0,o.kt)("h2",{id:"security-company"},"Security company"),(0,o.kt)("p",null,"As the security company is the witness of both the governance and the vehicles, it will be able to visualize the status of the vehicles at any time. To do so, the following command must be executed:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Security Company"',title:'"Node:',Security:!0,'Company"':!0},"curl 'http://localhost:3002/api/subjects/{{SUBJECT-ID}}'\n")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Note that in the request, you must replace ",(0,o.kt)("strong",{parentName:"p"},"{{SUBJECT-ID}}")," with the corresponding hash identifier.")))}h.isMDXComponent=!0}}]);