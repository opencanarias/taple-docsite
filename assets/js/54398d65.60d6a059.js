"use strict";(self.webpackChunkclassic=self.webpackChunkclassic||[]).push([[3754],{3905:(e,n,g)=>{g.d(n,{Zo:()=>i,kt:()=>c});var I=g(67294);function t(e,n,g){return n in e?Object.defineProperty(e,n,{value:g,enumerable:!0,configurable:!0,writable:!0}):e[n]=g,e}function C(e,n){var g=Object.keys(e);if(Object.getOwnPropertySymbols){var I=Object.getOwnPropertySymbols(e);n&&(I=I.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),g.push.apply(g,I)}return g}function a(e){for(var n=1;n<arguments.length;n++){var g=null!=arguments[n]?arguments[n]:{};n%2?C(Object(g),!0).forEach((function(n){t(e,n,g[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(g)):C(Object(g)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(g,n))}))}return e}function A(e,n){if(null==e)return{};var g,I,t=function(e,n){if(null==e)return{};var g,I,t={},C=Object.keys(e);for(I=0;I<C.length;I++)g=C[I],n.indexOf(g)>=0||(t[g]=e[g]);return t}(e,n);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(e);for(I=0;I<C.length;I++)g=C[I],n.indexOf(g)>=0||Object.prototype.propertyIsEnumerable.call(e,g)&&(t[g]=e[g])}return t}var l=I.createContext({}),o=function(e){var n=I.useContext(l),g=n;return e&&(g="function"==typeof e?e(n):a(a({},n),e)),g},i=function(e){var n=o(e.components);return I.createElement(l.Provider,{value:n},e.children)},r={inlineCode:"code",wrapper:function(e){var n=e.children;return I.createElement(I.Fragment,{},n)}},s=I.forwardRef((function(e,n){var g=e.components,t=e.mdxType,C=e.originalType,l=e.parentName,i=A(e,["components","mdxType","originalType","parentName"]),s=o(g),c=t,p=s["".concat(l,".").concat(c)]||s[c]||r[c]||C;return g?I.createElement(p,a(a({ref:n},i),{},{components:g})):I.createElement(p,a({ref:n},i))}));function c(e,n){var g=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var C=g.length,a=new Array(C);a[0]=s;var A={};for(var l in n)hasOwnProperty.call(n,l)&&(A[l]=n[l]);A.originalType=e,A.mdxType="string"==typeof e?e:t,a[1]=A;for(var o=2;o<C;o++)a[o]=g[o];return I.createElement.apply(null,a)}return I.createElement.apply(null,g)}s.displayName="MDXCreateElement"},82371:(e,n,g)=>{g.r(n),g.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>r,frontMatter:()=>C,metadata:()=>A,toc:()=>o});var I=g(87462),t=(g(67294),g(3905));const C={},a="Adding participants",A={unversionedId:"build/assets-traceability/adding-participants",id:"version-0.3/build/assets-traceability/adding-participants",title:"Adding participants",description:"Premium wines",source:"@site/versioned_docs/version-0.3/build/assets-traceability/adding-participants.md",sourceDirName:"build/assets-traceability",slug:"/build/assets-traceability/adding-participants",permalink:"/taple-docsite/docs/build/assets-traceability/adding-participants",draft:!1,tags:[],version:"0.3",lastUpdatedAt:1698048419,formattedLastUpdatedAt:"Oct 23, 2023",frontMatter:{},sidebar:"buildSidebar",previous:{title:"Adding a schema",permalink:"/taple-docsite/docs/build/assets-traceability/adding-schema"},next:{title:"Creating a subject",permalink:"/taple-docsite/docs/build/assets-traceability/creating-subject"}},l={},o=[{value:"Premium wines",id:"premium-wines",level:2},{value:"World Food Organization",id:"world-food-organization",level:2}],i={toc:o};function r(e){let{components:n,...g}=e;return(0,t.kt)("wrapper",(0,I.Z)({},i,g,{components:n,mdxType:"MDXLayout"}),(0,t.kt)("h1",{id:"adding-participants"},"Adding participants"),(0,t.kt)("h2",{id:"premium-wines"},"Premium wines"),(0,t.kt)("p",null,"Excellent, now we have the necessary schema to create ",(0,t.kt)("em",{parentName:"p"},"Wine")," type subjects. However, upon reflection, we realize that there is no one authorized to create and emit events related to this new schema. Therefore, we need to add a new participant to our network responsible for this task."),(0,t.kt)("p",null,"Let's start by setting up the corresponding node:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Premium wines"',title:'"Node:',Premium:!0,'wines"':!0},"docker run \\\n    -p 3001:3000 \\\n    -p 50001:50000 \\\n    -e TAPLE_HTTP=true \\\n    -e TAPLE_ID_PRIVATE_KEY=4f0e3c9cd24ab3420b81220bb7ebccb4e42501d3667dea81838b3bfaae20c936 \\\n    -e TAPLE_NETWORK_LISTEN_ADDR=/ip4/0.0.0.0/tcp/50001 \\\n    -e TAPLE_NETWORK_KNOWN_NODE=/ip4/172.17.0.1/tcp/50000/p2p/12D3KooWHHjN5vKSKeCWiBG3gHaDRDp6YzsEgu9iTesYqrWxAgFk \\\n    opencanarias/taple-client:0.3\n")),(0,t.kt)("p",null,"Next, we'll proceed to update the governance to include this new member and allow them to create ",(0,t.kt)("em",{parentName:"p"},"Wine")," type subjects."),(0,t.kt)("admonition",{type:"note"},(0,t.kt)("p",{parentName:"admonition"},"It's not necessary to assign them the role of a witness, as the subject's owner is the default witness.")),(0,t.kt)("p",null,"Let's verify the changes we want to make in the governance properties. At this point, our governance should look like the following:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "members": [\n        {\n            "id": "EbwR0yYrCYpTzlN5i5GX_MtAbKRw5y2euv3TqiTgwggs",\n            "name": "WPO"\n        }\n    ],\n    "roles": [\n        {\n            "namespace": "",\n            "role": "WITNESS",\n            "schema": {\n            "ID": "governance"\n            },\n            "who": "MEMBERS"\n        },\n        {\n            "namespace": "",\n            "role": "APPROVER",\n            "schema": {\n            "ID": "governance"\n            },\n            "who": {\n            "NAME": "WPO"\n            }\n        }\n    ]\n}\n')),(0,t.kt)("p",null,"Now, we need to incorporate the mentioned changes:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "members": [\n        \n        ...\n\n        {\n            "id": "Ee-ZvImOQSgRBDR9XH0uQ5gbVv4828h_o5GuLbWFWaLI",\n            "name": "PremiumWines"\n        }\n    ],\n    "roles": [\n\n        ...\n\n        {\n            "namespace": "",\n            "role": "CREATOR",\n            "schema": {\n                "ID": "Wine"\n            },\n            "who": {\n                "NAME": "PremiumWines"\n            }\n        }\n    ]\n}\n')),(0,t.kt)("p",null,"We'll use our ",(0,t.kt)("a",{parentName:"p",href:"/taple-docsite/docs/learn/client-tools#taple-patch"},(0,t.kt)("strong",{parentName:"a"},"TAPLE-Patch"))," tool to generate these changes, following the procedure below:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Another terminal"',title:'"Another','terminal"':!0},'taple-patch \'{"members":[{"id":"EbwR0yYrCYpTzlN5i5GX_MtAbKRw5y2euv3TqiTgwggs","name":"WPO"}],"roles":[{"namespace":"","role":"WITNESS","schema":{"ID":"governance"},"who":"MEMBERS"},{"namespace":"","role":"APPROVER","schema":{"ID":"governance"},"who":{"NAME":"WPO"}}]}\' \'{"members":[{"id":"EbwR0yYrCYpTzlN5i5GX_MtAbKRw5y2euv3TqiTgwggs","name":"WPO"},{"id":"Ee-ZvImOQSgRBDR9XH0uQ5gbVv4828h_o5GuLbWFWaLI","name":"PremiumWines"}],"roles":[{"namespace":"","role":"WITNESS","schema":{"ID":"governance"},"who":"MEMBERS"},{"namespace":"","role":"APPROVER","schema":{"ID":"governance"},"who":{"NAME":"WPO"}},{"namespace":"","role":"CREATOR","schema":{"ID":"Wine"},"who":{"NAME":"PremiumWines"}}]}\'\n')),(0,t.kt)("p",null,"The result obtained will be as follows:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "op": "add",\n    "path": "/members/1",\n    "value": {\n      "id": "Ee-ZvImOQSgRBDR9XH0uQ5gbVv4828h_o5GuLbWFWaLI",\n      "name": "PremiumWines"\n    }\n  },\n  {\n    "op": "add",\n    "path": "/roles/2",\n    "value": {\n      "namespace": "",\n      "role": "CREATOR",\n      "schema": {\n        "ID": "Wine"\n      },\n      "who": {\n        "NAME": "PremiumWines"\n      }\n    }\n  }\n]\n')),(0,t.kt)("p",null,"Now, it's time to call the method of the governance contract responsible for updating its properties. To do this, we'll execute the following:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: WPO"',title:'"Node:','WPO"':!0},'curl --request POST \'http://localhost:3000/api/event-requests\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "request": {\n    "Fact": {\n        "subject_id": {{GOVERNANCE-ID}},\n            "payload": {\n                "Patch": {\n                    "data": [{\n                        "op": "add",\n                        "path": "/members/1",\n                        "value": {\n                        "id": "Ee-ZvImOQSgRBDR9XH0uQ5gbVv4828h_o5GuLbWFWaLI",\n                        "name": "PremiumWines"\n                        }\n                    },\n                    {\n                        "op": "add",\n                        "path": "/roles/2",\n                        "value": {\n                            "namespace": "",\n                            "role": "CREATOR",\n                            "schema": {\n                                "ID": "Wine"\n                            },\n                            "who": {\n                                "NAME": "PremiumWines"\n                            }\n                        }\n                    }]\n                }\n            }\n        }\n    }\n}\'\n')),(0,t.kt)("p",null,"Once the event is emitted, we need to obtain the new update request. To do this, we run the following:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: WPO"',title:'"Node:','WPO"':!0},"curl --request GET 'http://localhost:3000/api/approval-requests?status=Pending'\n")),(0,t.kt)("p",null,"We copy the value of the ",(0,t.kt)("inlineCode",{parentName:"p"},"id")," field and accept the governance update request:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: WPO"',title:'"Node:','WPO"':!0},"curl --request PATCH 'http://localhost:3000/api/approval-requests/{{PREVIUS-ID}}' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{\"state\": \"RespondedAccepted\"}'\n")),(0,t.kt)("p",null,"We query the governance from the new node:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Premium Wines"',title:'"Node:',Premium:!0,'Wines"':!0},"curl --request GET 'http://localhost:3001/api/subjects/{{GOVERNANCE-ID}}'\n")),(0,t.kt)("p",null,"And we will get:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"Not found Subject JLblI3wVzvQZPxQlz-GE1p_6OmYuKr_WyFFV97wyQV54\n")),(0,t.kt)("p",null,"An error? But didn't we just include the new node in the governance, and it's a witness of it?"),(0,t.kt)("p",null,"While the last statement is true, we must consider the following: for security reasons, the Taple node rejects all subjects that have not been explicitly sent, unless one of the following two conditions is met: the governance is configured to consider it a witness, or we explicitly authorize the subject. In the case of the governance, it's special since there's no prior governance to authorize it, so the only way to access it is by explicitly authorizing it."),(0,t.kt)("p",null,"Therefore, we need to execute the following to receive governance information:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Premium Wines"',title:'"Node:',Premium:!0,'Wines"':!0},"curl --request PUT 'http://localhost:3001/api/allowed-subjects/{{GOVERNANCE-ID}}' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{\n    \"providers\": []\n}'\n")),(0,t.kt)("p",null,"Now, when trying to query the governance from the new node, we will get the expected information:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: Premium Wines"',title:'"Node:',Premium:!0,'Wines"':!0},"curl --request GET 'http://localhost:3001/api/subjects/{{GOVERNANCE-ID}}'\n")),(0,t.kt)("details",null,(0,t.kt)("summary",null,"Click to look at the full governance."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "subject_id": {{GOVERNANCE-ID}},\n    "governance_id": "",\n    "sn": 3,\n    "public_key": "EUtKgajygy2tS46YWZj2piM_dxQ2gguznnOXBAZSPRzA",\n    "namespace": "",\n    "name": "wine_track",\n    "schema_id": "governance",\n    "owner": "EbwR0yYrCYpTzlN5i5GX_MtAbKRw5y2euv3TqiTgwggs",\n    "creator": "EbwR0yYrCYpTzlN5i5GX_MtAbKRw5y2euv3TqiTgwggs",\n    "properties": {\n        "members": [\n            {\n                "id": "EbwR0yYrCYpTzlN5i5GX_MtAbKRw5y2euv3TqiTgwggs",\n                "name": "WPO"\n            },\n            {\n                "id": "Ee-ZvImOQSgRBDR9XH0uQ5gbVv4828h_o5GuLbWFWaLI",\n                "name": "PremiumWines"\n            }\n        ],\n        "policies": [\n            {\n                "approve": {\n                    "quorum": "MAJORITY"\n                },\n                "evaluate": {\n                    "quorum": "MAJORITY"\n                },\n                "id": "governance",\n                "validate": {\n                    "quorum": "MAJORITY"\n                }\n            },\n            {\n                "approve": {\n                    "quorum": "MAJORITY"\n                },\n                "evaluate": {\n                    "quorum": "MAJORITY"\n                },\n                "id": "Wine",\n                "validate": {\n                    "quorum": "MAJORITY"\n                }\n            }\n        ],\n        "roles": [\n            {\n                "namespace": "",\n                "role": "WITNESS",\n                "schema": {\n                    "ID": "governance"\n                },\n                "who": "MEMBERS"\n            },\n            {\n                "namespace": "",\n                "role": "APPROVER",\n                "schema": {\n                    "ID": "governance"\n                },\n                "who": {\n                    "NAME": "WPO"\n                }\n            },\n            {\n                "namespace": "",\n                "role": "CREATOR",\n                "schema": {\n                    "ID": "Wine"\n                },\n                "who": {\n                    "NAME": "PremiumWines"\n                }\n            }\n        ],\n        "schemas": [\n            {\n                "contract": {\n                    "raw": "dXNlIHRhcGxlX3NjX3J1c3QgYXMgc2RrOw0KdXNlIHNlcmRlOjp7RGVzZXJpYWxpemUsIFNlcmlhbGl6ZX07DQoNCiNbZGVyaXZlKFNlcmlhbGl6ZSwgRGVzZXJpYWxpemUsIENsb25lLCBQYXJ0aWFsRXEpXSANCmVudW0gR3JhcGUgew0KICAgIENhYmVybmV0U2F1dmlnbm9uLA0KICAgIENoYXJkb25uYXksDQogICAgUGlub3ROb2lyLA0KfQ0KDQojW2Rlcml2ZShTZXJpYWxpemUsIERlc2VyaWFsaXplLCBDbG9uZSldDQpzdHJ1Y3QgVGVtcGVyYXR1cmVDb250cm9sIHsNCiAgICBwdWIgbGFzdF9jaGVjazogdTMyLA0KICAgIHB1YiB0ZW1wZXJhdHVyZV9vazogYm9vbCwNCn0NCg0KI1tkZXJpdmUoU2VyaWFsaXplLCBEZXNlcmlhbGl6ZSwgQ2xvbmUpXQ0Kc3RydWN0IFN0YXRlIHsNCiAgICBwdWIgaGFydmVzdDogdTMyLA0KICAgIHB1YiBncmFwZTogT3B0aW9uPEdyYXBlPiwNCiAgICBwdWIgb3JpZ2luOiBTdHJpbmcsDQogICAgcHViIG9yZ2FuaWNfY2VydGlmaWVkOiBPcHRpb248Ym9vbD4sDQogICAgcHViIHRlbXBlcmF0dXJlX2NvbnRyb2w6IFRlbXBlcmF0dXJlQ29udHJvbCwNCn0NCg0KI1tkZXJpdmUoU2VyaWFsaXplLCBEZXNlcmlhbGl6ZSldDQplbnVtIFN0YXRlRXZlbnQgew0KICAgIEluaXQgew0KICAgICAgICBoYXJ2ZXN0OiB1MzIsDQogICAgICAgIGdyYXBlOiBTdHJpbmcsDQogICAgICAgIG9yaWdpbjogU3RyaW5nLA0KICAgIH0sDQogICAgVGVtcGVyYXR1cmVDb250cm9sIHsNCiAgICAgICAgdGVtcGVyYXR1cmU6IGYzMiwNCiAgICAgICAgdGltZXN0YW1wOiB1MzIsDQogICAgfSwNCiAgICBPcmdhbmljQ2VydGlmaWNhdGlvbiB7DQogICAgICAgIGZlcnRpbGl6ZXJzX2NvbnRyb2w6IGJvb2wsDQogICAgICAgIHBlc3RpY2lkZXNfY29udHJvbDogYm9vbCwNCiAgICAgICAgYW5hbHl0aWNzOiBib29sLA0KICAgICAgICBhZGRpdGlvbmFsX2luZm86IFN0cmluZywNCiAgICB9LA0KfQ0KDQpjb25zdCBURU1QRVJBVFVSRV9SQU5HRTogKGYzMiwgZjMyKSA9ICgxMC4wLCAxNi4wKTsNCg0KI1tub19tYW5nbGVdDQpwdWIgdW5zYWZlIGZuIG1haW5fZnVuY3Rpb24oc3RhdGVfcHRyOiBpMzIsIGV2ZW50X3B0cjogaTMyLCBpc19vd25lcjogaTMyKSAtPiB1MzIgew0KICAgIHNkazo6ZXhlY3V0ZV9jb250cmFjdChzdGF0ZV9wdHIsIGV2ZW50X3B0ciwgaXNfb3duZXIsIGNvbnRyYWN0X2xvZ2ljKQ0KfQ0KDQpmbiBjb250cmFjdF9sb2dpYygNCiAgICBjb250ZXh0OiAmc2RrOjpDb250ZXh0PFN0YXRlLCBTdGF0ZUV2ZW50PiwNCiAgICBjb250cmFjdF9yZXN1bHQ6ICZtdXQgc2RrOjpDb250cmFjdFJlc3VsdDxTdGF0ZT4sDQopIHsNCiAgICBsZXQgc3RhdGUgPSAmbXV0IGNvbnRyYWN0X3Jlc3VsdC5maW5hbF9zdGF0ZTsNCiAgICBtYXRjaCAmY29udGV4dC5ldmVudCB7DQogICAgICAgIFN0YXRlRXZlbnQ6OkluaXQgew0KICAgICAgICAgICAgaGFydmVzdCwNCiAgICAgICAgICAgIGdyYXBlLA0KICAgICAgICAgICAgb3JpZ2luLA0KICAgICAgICB9ID0+IHsNCiAgICAgICAgICAgIGlmIGNvbnRleHQuaXNfb3duZXIgJiYgIWNoZWNrX3N1YmplY3RfaGFzX2JlZW5faW5pdGlhdGVkKHN0YXRlKSB7IC8vIFNvbG8gbG8gcHVlZGRlIGhhY2VyIGVsIHByb3BpZXRhcmlvw6cNCiAgICAgICAgICAgICAgICBsZXQgZ3JhcGUgPSBtYXRjaCBncmFwZS5hc19zdHIoKSB7DQogICAgICAgICAgICAgICAgICAgICJDYWJlcm5ldFNhdXZpZ25vbiIgPT4gU29tZShHcmFwZTo6Q2FiZXJuZXRTYXV2aWdub24pLA0KICAgICAgICAgICAgICAgICAgICAiQ2hhcmRvbm5heSIgPT4gU29tZShHcmFwZTo6Q2hhcmRvbm5heSksDQogICAgICAgICAgICAgICAgICAgICJQaW5vdE5vaXIiID0+IFNvbWUoR3JhcGU6OlBpbm90Tm9pciksDQogICAgICAgICAgICAgICAgICAgIF8gPT4gTm9uZSwNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGlmIGdyYXBlLmlzX3NvbWUoKSB7DQogICAgICAgICAgICAgICAgICAgIHN0YXRlLmhhcnZlc3QgPSAqaGFydmVzdDsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUuZ3JhcGUgPSBncmFwZTsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUub3JpZ2luID0gb3JpZ2luLnRvX3N0cmluZygpOw0KICAgICAgICAgICAgICAgICAgICBjb250cmFjdF9yZXN1bHQuc3VjY2VzcyA9IHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIFN0YXRlRXZlbnQ6OlRlbXBlcmF0dXJlQ29udHJvbCB7DQogICAgICAgICAgICB0ZW1wZXJhdHVyZSwNCiAgICAgICAgICAgIHRpbWVzdGFtcCwNCiAgICAgICAgfSA9PiB7DQogICAgICAgICAgICBpZiBjb250ZXh0LmlzX293bmVyICYmIGNoZWNrX3N1YmplY3RfaGFzX2JlZW5faW5pdGlhdGVkKHN0YXRlKSB7DQogICAgICAgICAgICAgICAgaWYgY2hlY2tfdGVtcGVyYXR1cmVfaW5fcmFuZ2UoKnRlbXBlcmF0dXJlKQ0KICAgICAgICAgICAgICAgICAgICAmJiBzdGF0ZS50ZW1wZXJhdHVyZV9jb250cm9sLnRlbXBlcmF0dXJlX29rDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdGF0ZS50ZW1wZXJhdHVyZV9jb250cm9sLmxhc3RfY2hlY2sgPSAqdGltZXN0YW1wOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHN0YXRlLnRlbXBlcmF0dXJlX2NvbnRyb2wudGVtcGVyYXR1cmVfb2sgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUudGVtcGVyYXR1cmVfY29udHJvbC5sYXN0X2NoZWNrID0gKnRpbWVzdGFtcDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29udHJhY3RfcmVzdWx0LnN1Y2Nlc3MgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIFN0YXRlRXZlbnQ6Ok9yZ2FuaWNDZXJ0aWZpY2F0aW9uIHsNCiAgICAgICAgICAgIGZlcnRpbGl6ZXJzX2NvbnRyb2wsDQogICAgICAgICAgICBwZXN0aWNpZGVzX2NvbnRyb2wsDQogICAgICAgICAgICBhbmFseXRpY3MsDQogICAgICAgICAgICBhZGRpdGlvbmFsX2luZm8sDQogICAgICAgIH0gPT4gew0KICAgICAgICAgICAgaWYgY2hlY2tfc3ViamVjdF9oYXNfYmVlbl9pbml0aWF0ZWQoc3RhdGUpIHsNCiAgICAgICAgICAgICAgICBtYXRjaCBzdGF0ZS5vcmdhbmljX2NlcnRpZmllZCB7DQogICAgICAgICAgICAgICAgICAgIFNvbWUob3JnYW5pY19jZXJpZmllZCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3JnYW5pY19jZXJpZmllZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmICFjaGVja19pc19vcmdhbmljKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqZmVydGlsaXplcnNfY29udHJvbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKnBlc3RpY2lkZXNfY29udHJvbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKmFuYWx5dGljcywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUub3JnYW5pY19jZXJ0aWZpZWQgPSBTb21lKGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBOb25lID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoZWNrX2lzX29yZ2FuaWMoKmZlcnRpbGl6ZXJzX2NvbnRyb2wsICpwZXN0aWNpZGVzX2NvbnRyb2wsICphbmFseXRpY3MpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5vcmdhbmljX2NlcnRpZmllZCA9IFNvbWUodHJ1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLm9yZ2FuaWNfY2VydGlmaWVkID0gU29tZShmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29udHJhY3RfcmVzdWx0LnN1Y2Nlc3MgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0KDQpmbiBjaGVja19zdWJqZWN0X2hhc19iZWVuX2luaXRpYXRlZChzdGF0ZTogJlN0YXRlKSAtPiBib29sIHsNCiAgICBsZXQgaW5pdGlhbF9ncmFwZSA9IG1hdGNoIHN0YXRlLmdyYXBlIHsNCiAgICAgICAgU29tZShfKSA9PiBmYWxzZSwNCiAgICAgICAgTm9uZSA9PiB0cnVlLA0KICAgIH07DQogICAgaWYgc3RhdGUuaGFydmVzdCA9PSAwICYmIGluaXRpYWxfZ3JhcGUgJiYgc3RhdGUub3JpZ2luID09IGZvcm1hdCEoIiIpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICByZXR1cm4gdHJ1ZTsNCn0NCg0KZm4gY2hlY2tfdGVtcGVyYXR1cmVfaW5fcmFuZ2UodGVtcGVyYXR1cmU6IGYzMikgLT4gYm9vbCB7DQogICAgaWYgdGVtcGVyYXR1cmUgPj0gVEVNUEVSQVRVUkVfUkFOR0UuMCAmJiB0ZW1wZXJhdHVyZSA8PSBURU1QRVJBVFVSRV9SQU5HRS4xIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHJldHVybiBmYWxzZTsNCn0NCg0KZm4gY2hlY2tfaXNfb3JnYW5pYyhmZXJ0aWxpemVyc19jb250cm9sOiBib29sLCBwZXN0aWNpZGVzX2NvbnRyb2w6IGJvb2wsIGFuYWx5dGljczogYm9vbCkgLT4gYm9vbCB7DQogICAgaWYgZmVydGlsaXplcnNfY29udHJvbCAmJiBwZXN0aWNpZGVzX2NvbnRyb2wgJiYgYW5hbHl0aWNzIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHJldHVybiBmYWxzZTsNCn0="\n                },\n                "id": "Wine",\n                "initial_value": {\n                    "grape": null,\n                    "harvest": 0,\n                    "organic_certified": null,\n                    "origin": "",\n                    "temperature_control": {\n                        "last_check": 0,\n                        "temperature_ok": true\n                    }\n                },\n                "schema": {\n                    "additionalProperties": false,\n                    "description": "Representation of a bottle of wine",\n                    "properties": {\n                        "grape": {\n                            "description": "Type of grape",\n                            "enum": [\n                                "CabernetSauvignon",\n                                "Chardonnay",\n                                "PinotNoir",\n                                null\n                            ],\n                            "type": [\n                                "string",\n                                "null"\n                            ]\n                        },\n                        "harvest": {\n                            "description": "Harvest number",\n                            "type": "integer"\n                        },\n                        "organic_certified": {\n                            "description": "Certificate authenticating whether it is organic or not",\n                            "type": [\n                                "boolean",\n                                "null"\n                            ]\n                        },\n                        "origin": {\n                            "description": "Origin of the grape",\n                            "type": "string"\n                        },\n                        "temperature_control": {\n                            "additionalProperties": false,\n                            "description": "Values to be changed in the temperature control event",\n                            "properties": {\n                                "last_check": {\n                                    "description": "Timestamp of last check",\n                                    "type": "integer"\n                                },\n                                "temperature_ok": {\n                                    "description": "Value that corroborates whether the wine cold chain has been complied with",\n                                    "type": "boolean"\n                                }\n                            },\n                            "required": [\n                                "last_check",\n                                "temperature_ok"\n                            ],\n                            "type": "object"\n                        }\n                    },\n                    "required": [\n                        "harvest",\n                        "grape",\n                        "origin",\n                        "organic_certified",\n                        "temperature_control"\n                    ],\n                    "type": "object"\n                }\n            }\n        ]\n    },\n    "active": true\n}\n'))),(0,t.kt)("h2",{id:"world-food-organization"},"World Food Organization"),(0,t.kt)("p",null,"Currently, ",(0,t.kt)("strong",{parentName:"p"},"WPO")," is the only owner of the governance and has the exclusive power to approve changes to it. However, this poses a problem since its power is absolute, and, for example, it lacks representation or influence from around the world on the changes made to this governance. Therefore, there is a need to add a new member to the governance, ",(0,t.kt)("em",{parentName:"p"},"World Food Organization")," (",(0,t.kt)("strong",{parentName:"p"},"WFO"),"), which will act as the second validator and prevent the existing monopoly by ",(0,t.kt)("strong",{parentName:"p"},"WPO"),"."),(0,t.kt)("p",null,"To achieve this, we'll allow ",(0,t.kt)("strong",{parentName:"p"},"WFO")," to take on the roles of an approver, validator, and evaluator of the governance. Furthermore, it will be allowed to act as a witness to ",(0,t.kt)("em",{parentName:"p"},"Wine")," type subjects since it's interested in collecting consumption statistics."),(0,t.kt)("p",null,"Let's start by setting up the ",(0,t.kt)("strong",{parentName:"p"},"WFO")," node:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: WFO"',title:'"Node:','WFO"':!0},"docker run \\\n    -p 3002:3000 \\\n    -p 50002:50000 \\\n    -e TAPLE_HTTP=true \\\n    -e TAPLE_ID_PRIVATE_KEY=6d3103185146ecedd28d3759df693999927e69aacb55e1aa9fe7ac17555da81c \\\n    -e TAPLE_NETWORK_LISTEN_ADDR=/ip4/0.0.0.0/tcp/50002 \\\n    -e TAPLE_NETWORK_KNOWN_NODE=/ip4/172.17.0.1/tcp/50000/p2p/12D3KooWHHjN5vKSKeCWiBG3gHaDRDp6YzsEgu9iTesYqrWxAgFk \\\n    opencanarias/taple-client:0.3 \n")),(0,t.kt)("p",null,"Next, we'll proceed to update the governance to grant it the mentioned properties:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash",metastring:'bash title="Node: WFO"',bash:!0,title:'"Node:','WFO"':!0},'curl --request POST \'http://localhost:3000/api/event-requests\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "request": {\n    "Fact": {\n        "subject_id": {{GOVERNANCE-ID}},\n            "payload": {\n                "Patch": {\n                    "data": [{\n                        "op": "add",\n                        "path": "/members/2",\n                        "value": {\n                        "id": "EICgJYOXXRFqDMiFsrCcUgPYnCSgUT-zwe66LP8rDpPU",\n                        "name": "WFO"\n                        }\n                    },\n                    {\n                        "op": "add",\n                        "path": "/roles/3",\n                        "value": {\n                            "namespace": "",\n                            "role": "APPROVER",\n                            "schema": {\n                                "ID": "governance"\n                            },\n                            "who": {\n                                "NAME": "WFO"\n                            }\n                        }\n                    },\n                    {\n                        "op": "add",\n                        "path": "/roles/4",\n                        "value": {\n                            "namespace": "",\n                            "role": "VALIDATOR",\n                            "schema": {\n                                "ID": "governance"\n                            },\n                            "who": {\n                                "NAME": "WFO"\n                            }\n                        }\n                    },\n                    {\n                        "op": "add",\n                        "path": "/roles/5",\n                        "value": {\n                            "namespace": "",\n                            "role": "EVALUATOR",\n                            "schema": {\n                                "ID": "governance"\n                            },\n                            "who": {\n                                "NAME": "WFO"\n                            }\n                        }\n                    },\n                    {\n                        "op": "add",\n                        "path": "/roles/6",\n                        "value": {\n                            "namespace": "",\n                            "role": "WITNESS",\n                            "schema": {\n                                "ID": "Wine"\n                            },\n                            "who": {\n                                "NAME": "WFO"\n                            }\n                        }\n                    }]\n                }\n            }\n        }\n    }\n}\'\n')),(0,t.kt)("admonition",{type:"note"},(0,t.kt)("p",{parentName:"admonition"},"At this point, the steps to generate the new ",(0,t.kt)("em",{parentName:"p"},"json-patch")," for the governance are not described since they are detailed in the ",(0,t.kt)("a",{parentName:"p",href:"#premium-wines"},"previous section"),".")),(0,t.kt)("p",null,"Once this command is executed, we should obtain the update request again. To do this, we run:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: WPO"',title:'"Node:','WPO"':!0},"curl --request GET 'http://localhost:3000/api/approval-requests?status=Pending'\n")),(0,t.kt)("p",null,"We copy the value of the ",(0,t.kt)("inlineCode",{parentName:"p"},"id")," field and accept the governance update request:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: WPO"',title:'"Node:','WPO"':!0},"curl --request PATCH 'http://localhost:3000/api/approval-requests/{{PREVIUS-ID}}' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{\"state\": \"RespondedAccepted\"}'\n")),(0,t.kt)("p",null,"At this point, we'll find ourselves in a situation similar to the one described in the ",(0,t.kt)("a",{parentName:"p",href:"#premium-wines"},"previous section"),". Although the new node is part of the governance, it's not able to receive its information, so we need to perform its pre-authorization. To do this, we'll execute the following command:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: WFO"',title:'"Node:','WFO"':!0},"curl --request PUT 'http://localhost:3002/api/allowed-subjects/{{GOVERNANCE-ID}}' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{\n    \"providers\": []\n}'\n")),(0,t.kt)("p",null,"If everything has gone as expected, we can now query the governance from the new node, and it should now have an ",(0,t.kt)("inlineCode",{parentName:"p"},"sn")," value of 4, as well as the change made in members and roles."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Node: WFO"',title:'"Node:','WFO"':!0},"curl --request GET 'http://localhost:3002/api/subjects/{{GOVERNANCE-ID}}'\n")),(0,t.kt)("details",null,(0,t.kt)("summary",null,"Click to look at the full governance."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "subject_id": {{GOVERNANCE-ID}},\n    "governance_id": "",\n    "sn": 4,\n    "public_key": "E8tVWEasubIp7P9fzk_HttNCsABymV9m9xEPAfr-QV7M",\n    "namespace": "",\n    "name": "wine_track",\n    "schema_id": "governance",\n    "owner": "EbwR0yYrCYpTzlN5i5GX_MtAbKRw5y2euv3TqiTgwggs",\n    "creator": "EbwR0yYrCYpTzlN5i5GX_MtAbKRw5y2euv3TqiTgwggs",\n    "properties": {\n        "members": [\n            {\n                "id": "EbwR0yYrCYpTzlN5i5GX_MtAbKRw5y2euv3TqiTgwggs",\n                "name": "WPO"\n            },\n            {\n                "id": "Ee-ZvImOQSgRBDR9XH0uQ5gbVv4828h_o5GuLbWFWaLI",\n                "name": "PremiumWines"\n            },\n            {\n                "id": "EICgJYOXXRFqDMiFsrCcUgPYnCSgUT-zwe66LP8rDpPU",\n                "name": "WFO"\n            }\n        ],\n        "policies": [\n            {\n                "approve": {\n                    "quorum": "MAJORITY"\n                },\n                "evaluate": {\n                    "quorum": "MAJORITY"\n                },\n                "id": "governance",\n                "validate": {\n                    "quorum": "MAJORITY"\n                }\n            },\n            {\n                "approve": {\n                    "quorum": "MAJORITY"\n                },\n                "evaluate": {\n                    "quorum": "MAJORITY"\n                },\n                "id": "Wine",\n                "validate": {\n                    "quorum": "MAJORITY"\n                }\n            }\n        ],\n        "roles": [\n            {\n                "namespace": "",\n                "role": "WITNESS",\n                "schema": {\n                    "ID": "governance"\n                },\n                "who": "MEMBERS"\n            },\n            {\n                "namespace": "",\n                "role": "APPROVER",\n                "schema": {\n                    "ID": "governance"\n                },\n                "who": {\n                    "NAME": "WPO"\n                }\n            },\n            {\n                "namespace": "",\n                "role": "CREATOR",\n                "schema": {\n                    "ID": "Wine"\n                },\n                "who": {\n                    "NAME": "PremiumWines"\n                }\n            },\n            {\n                "namespace": "",\n                "role": "APPROVER",\n                "schema": {\n                    "ID": "governance"\n                },\n                "who": {\n                    "NAME": "WFO"\n                }\n            },\n            {\n                "namespace": "",\n                "role": "VALIDATOR",\n                "schema": {\n                    "ID": "governance"\n                },\n                "who": {\n                    "NAME": "WFO"\n                }\n            },\n            {\n                "namespace": "",\n                "role": "EVALUATOR",\n                "schema": {\n                    "ID": "governance"\n                },\n                "who": {\n                    "NAME": "WFO"\n                }\n            },\n            {\n                "namespace": "",\n                "role": "WITNESS",\n                "schema": {\n                    "ID": "Wine"\n                },\n                "who": {\n                    "NAME": "WFO"\n                }\n            }\n        ],\n        "schemas": [\n            {\n                "contract": {\n                    "raw": "dXNlIHRhcGxlX3NjX3J1c3QgYXMgc2RrOw0KdXNlIHNlcmRlOjp7RGVzZXJpYWxpemUsIFNlcmlhbGl6ZX07DQoNCiNbZGVyaXZlKFNlcmlhbGl6ZSwgRGVzZXJpYWxpemUsIENsb25lLCBQYXJ0aWFsRXEpXSANCmVudW0gR3JhcGUgew0KICAgIENhYmVybmV0U2F1dmlnbm9uLA0KICAgIENoYXJkb25uYXksDQogICAgUGlub3ROb2lyLA0KfQ0KDQojW2Rlcml2ZShTZXJpYWxpemUsIERlc2VyaWFsaXplLCBDbG9uZSldDQpzdHJ1Y3QgVGVtcGVyYXR1cmVDb250cm9sIHsNCiAgICBwdWIgbGFzdF9jaGVjazogdTMyLA0KICAgIHB1YiB0ZW1wZXJhdHVyZV9vazogYm9vbCwNCn0NCg0KI1tkZXJpdmUoU2VyaWFsaXplLCBEZXNlcmlhbGl6ZSwgQ2xvbmUpXQ0Kc3RydWN0IFN0YXRlIHsNCiAgICBwdWIgaGFydmVzdDogdTMyLA0KICAgIHB1YiBncmFwZTogT3B0aW9uPEdyYXBlPiwNCiAgICBwdWIgb3JpZ2luOiBTdHJpbmcsDQogICAgcHViIG9yZ2FuaWNfY2VydGlmaWVkOiBPcHRpb248Ym9vbD4sDQogICAgcHViIHRlbXBlcmF0dXJlX2NvbnRyb2w6IFRlbXBlcmF0dXJlQ29udHJvbCwNCn0NCg0KI1tkZXJpdmUoU2VyaWFsaXplLCBEZXNlcmlhbGl6ZSldDQplbnVtIFN0YXRlRXZlbnQgew0KICAgIEluaXQgew0KICAgICAgICBoYXJ2ZXN0OiB1MzIsDQogICAgICAgIGdyYXBlOiBTdHJpbmcsDQogICAgICAgIG9yaWdpbjogU3RyaW5nLA0KICAgIH0sDQogICAgVGVtcGVyYXR1cmVDb250cm9sIHsNCiAgICAgICAgdGVtcGVyYXR1cmU6IGYzMiwNCiAgICAgICAgdGltZXN0YW1wOiB1MzIsDQogICAgfSwNCiAgICBPcmdhbmljQ2VydGlmaWNhdGlvbiB7DQogICAgICAgIGZlcnRpbGl6ZXJzX2NvbnRyb2w6IGJvb2wsDQogICAgICAgIHBlc3RpY2lkZXNfY29udHJvbDogYm9vbCwNCiAgICAgICAgYW5hbHl0aWNzOiBib29sLA0KICAgICAgICBhZGRpdGlvbmFsX2luZm86IFN0cmluZywNCiAgICB9LA0KfQ0KDQpjb25zdCBURU1QRVJBVFVSRV9SQU5HRTogKGYzMiwgZjMyKSA9ICgxMC4wLCAxNi4wKTsNCg0KI1tub19tYW5nbGVdDQpwdWIgdW5zYWZlIGZuIG1haW5fZnVuY3Rpb24oc3RhdGVfcHRyOiBpMzIsIGV2ZW50X3B0cjogaTMyLCBpc19vd25lcjogaTMyKSAtPiB1MzIgew0KICAgIHNkazo6ZXhlY3V0ZV9jb250cmFjdChzdGF0ZV9wdHIsIGV2ZW50X3B0ciwgaXNfb3duZXIsIGNvbnRyYWN0X2xvZ2ljKQ0KfQ0KDQpmbiBjb250cmFjdF9sb2dpYygNCiAgICBjb250ZXh0OiAmc2RrOjpDb250ZXh0PFN0YXRlLCBTdGF0ZUV2ZW50PiwNCiAgICBjb250cmFjdF9yZXN1bHQ6ICZtdXQgc2RrOjpDb250cmFjdFJlc3VsdDxTdGF0ZT4sDQopIHsNCiAgICBsZXQgc3RhdGUgPSAmbXV0IGNvbnRyYWN0X3Jlc3VsdC5maW5hbF9zdGF0ZTsNCiAgICBtYXRjaCAmY29udGV4dC5ldmVudCB7DQogICAgICAgIFN0YXRlRXZlbnQ6OkluaXQgew0KICAgICAgICAgICAgaGFydmVzdCwNCiAgICAgICAgICAgIGdyYXBlLA0KICAgICAgICAgICAgb3JpZ2luLA0KICAgICAgICB9ID0+IHsNCiAgICAgICAgICAgIGlmIGNvbnRleHQuaXNfb3duZXIgJiYgIWNoZWNrX3N1YmplY3RfaGFzX2JlZW5faW5pdGlhdGVkKHN0YXRlKSB7IC8vIFNvbG8gbG8gcHVlZGRlIGhhY2VyIGVsIHByb3BpZXRhcmlvw6cNCiAgICAgICAgICAgICAgICBsZXQgZ3JhcGUgPSBtYXRjaCBncmFwZS5hc19zdHIoKSB7DQogICAgICAgICAgICAgICAgICAgICJDYWJlcm5ldFNhdXZpZ25vbiIgPT4gU29tZShHcmFwZTo6Q2FiZXJuZXRTYXV2aWdub24pLA0KICAgICAgICAgICAgICAgICAgICAiQ2hhcmRvbm5heSIgPT4gU29tZShHcmFwZTo6Q2hhcmRvbm5heSksDQogICAgICAgICAgICAgICAgICAgICJQaW5vdE5vaXIiID0+IFNvbWUoR3JhcGU6OlBpbm90Tm9pciksDQogICAgICAgICAgICAgICAgICAgIF8gPT4gTm9uZSwNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGlmIGdyYXBlLmlzX3NvbWUoKSB7DQogICAgICAgICAgICAgICAgICAgIHN0YXRlLmhhcnZlc3QgPSAqaGFydmVzdDsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUuZ3JhcGUgPSBncmFwZTsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUub3JpZ2luID0gb3JpZ2luLnRvX3N0cmluZygpOw0KICAgICAgICAgICAgICAgICAgICBjb250cmFjdF9yZXN1bHQuc3VjY2VzcyA9IHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIFN0YXRlRXZlbnQ6OlRlbXBlcmF0dXJlQ29udHJvbCB7DQogICAgICAgICAgICB0ZW1wZXJhdHVyZSwNCiAgICAgICAgICAgIHRpbWVzdGFtcCwNCiAgICAgICAgfSA9PiB7DQogICAgICAgICAgICBpZiBjb250ZXh0LmlzX293bmVyICYmIGNoZWNrX3N1YmplY3RfaGFzX2JlZW5faW5pdGlhdGVkKHN0YXRlKSB7DQogICAgICAgICAgICAgICAgaWYgY2hlY2tfdGVtcGVyYXR1cmVfaW5fcmFuZ2UoKnRlbXBlcmF0dXJlKQ0KICAgICAgICAgICAgICAgICAgICAmJiBzdGF0ZS50ZW1wZXJhdHVyZV9jb250cm9sLnRlbXBlcmF0dXJlX29rDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzdGF0ZS50ZW1wZXJhdHVyZV9jb250cm9sLmxhc3RfY2hlY2sgPSAqdGltZXN0YW1wOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHN0YXRlLnRlbXBlcmF0dXJlX2NvbnRyb2wudGVtcGVyYXR1cmVfb2sgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUudGVtcGVyYXR1cmVfY29udHJvbC5sYXN0X2NoZWNrID0gKnRpbWVzdGFtcDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29udHJhY3RfcmVzdWx0LnN1Y2Nlc3MgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIFN0YXRlRXZlbnQ6Ok9yZ2FuaWNDZXJ0aWZpY2F0aW9uIHsNCiAgICAgICAgICAgIGZlcnRpbGl6ZXJzX2NvbnRyb2wsDQogICAgICAgICAgICBwZXN0aWNpZGVzX2NvbnRyb2wsDQogICAgICAgICAgICBhbmFseXRpY3MsDQogICAgICAgICAgICBhZGRpdGlvbmFsX2luZm8sDQogICAgICAgIH0gPT4gew0KICAgICAgICAgICAgaWYgY2hlY2tfc3ViamVjdF9oYXNfYmVlbl9pbml0aWF0ZWQoc3RhdGUpIHsNCiAgICAgICAgICAgICAgICBtYXRjaCBzdGF0ZS5vcmdhbmljX2NlcnRpZmllZCB7DQogICAgICAgICAgICAgICAgICAgIFNvbWUob3JnYW5pY19jZXJpZmllZCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3JnYW5pY19jZXJpZmllZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmICFjaGVja19pc19vcmdhbmljKA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqZmVydGlsaXplcnNfY29udHJvbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKnBlc3RpY2lkZXNfY29udHJvbCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKmFuYWx5dGljcywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUub3JnYW5pY19jZXJ0aWZpZWQgPSBTb21lKGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBOb25lID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoZWNrX2lzX29yZ2FuaWMoKmZlcnRpbGl6ZXJzX2NvbnRyb2wsICpwZXN0aWNpZGVzX2NvbnRyb2wsICphbmFseXRpY3MpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5vcmdhbmljX2NlcnRpZmllZCA9IFNvbWUodHJ1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLm9yZ2FuaWNfY2VydGlmaWVkID0gU29tZShmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29udHJhY3RfcmVzdWx0LnN1Y2Nlc3MgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0KDQpmbiBjaGVja19zdWJqZWN0X2hhc19iZWVuX2luaXRpYXRlZChzdGF0ZTogJlN0YXRlKSAtPiBib29sIHsNCiAgICBsZXQgaW5pdGlhbF9ncmFwZSA9IG1hdGNoIHN0YXRlLmdyYXBlIHsNCiAgICAgICAgU29tZShfKSA9PiBmYWxzZSwNCiAgICAgICAgTm9uZSA9PiB0cnVlLA0KICAgIH07DQogICAgaWYgc3RhdGUuaGFydmVzdCA9PSAwICYmIGluaXRpYWxfZ3JhcGUgJiYgc3RhdGUub3JpZ2luID09IGZvcm1hdCEoIiIpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICByZXR1cm4gdHJ1ZTsNCn0NCg0KZm4gY2hlY2tfdGVtcGVyYXR1cmVfaW5fcmFuZ2UodGVtcGVyYXR1cmU6IGYzMikgLT4gYm9vbCB7DQogICAgaWYgdGVtcGVyYXR1cmUgPj0gVEVNUEVSQVRVUkVfUkFOR0UuMCAmJiB0ZW1wZXJhdHVyZSA8PSBURU1QRVJBVFVSRV9SQU5HRS4xIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHJldHVybiBmYWxzZTsNCn0NCg0KZm4gY2hlY2tfaXNfb3JnYW5pYyhmZXJ0aWxpemVyc19jb250cm9sOiBib29sLCBwZXN0aWNpZGVzX2NvbnRyb2w6IGJvb2wsIGFuYWx5dGljczogYm9vbCkgLT4gYm9vbCB7DQogICAgaWYgZmVydGlsaXplcnNfY29udHJvbCAmJiBwZXN0aWNpZGVzX2NvbnRyb2wgJiYgYW5hbHl0aWNzIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIHJldHVybiBmYWxzZTsNCn0="\n                },\n                "id": "Wine",\n                "initial_value": {\n                    "grape": null,\n                    "harvest": 0,\n                    "organic_certified": null,\n                    "origin": "",\n                    "temperature_control": {\n                        "last_check": 0,\n                        "temperature_ok": true\n                    }\n                },\n                "schema": {\n                    "additionalProperties": false,\n                    "description": "Representation of a bottle of wine",\n                    "properties": {\n                        "grape": {\n                            "description": "Type of grape",\n                            "enum": [\n                                "CabernetSauvignon",\n                                "Chardonnay",\n                                "PinotNoir",\n                                null\n                            ],\n                            "type": [\n                                "string",\n                                "null"\n                            ]\n                        },\n                        "harvest": {\n                            "description": "Harvest number",\n                            "type": "integer"\n                        },\n                        "organic_certified": {\n                            "description": "Certificate authenticating whether it is organic or not",\n                            "type": [\n                                "boolean",\n                                "null"\n                            ]\n                        },\n                        "origin": {\n                            "description": "Origin of the grape",\n                            "type": "string"\n                        },\n                        "temperature_control": {\n                            "additionalProperties": false,\n                            "description": "Values to be changed in the temperature control event",\n                            "properties": {\n                                "last_check": {\n                                    "description": "Timestamp of last check",\n                                    "type": "integer"\n                                },\n                                "temperature_ok": {\n                                    "description": "Value that corroborates whether the wine cold chain has been complied with",\n                                    "type": "boolean"\n                                }\n                            },\n                            "required": [\n                                "last_check",\n                                "temperature_ok"\n                            ],\n                            "type": "object"\n                        }\n                    },\n                    "required": [\n                        "harvest",\n                        "grape",\n                        "origin",\n                        "organic_certified",\n                        "temperature_control"\n                    ],\n                    "type": "object"\n                }\n            }\n        ]\n    },\n    "active": true\n}\n'))))}r.isMDXComponent=!0}}]);